/**
 * angular-timer - v1.0.7 - 2013-11-27 1:48 PM
 * https://github.com/siddii/angular-timer
 *
 * Copyright (c) 2013 Siddique Hameed
 * Licensed MIT <https://github.com/siddii/angular-timer/blob/master/LICENSE.txt>
 */
angular.module("timer",[]).directive("timer",["$compile",function($compile){return{restrict:"E",replace:!1,scope:{interval:"=interval",startTimeAttr:"=startTime",endTimeAttr:"=endTime",countdownattr:"=countdown",autoStart:"&autoStart"},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){function resetTimeout(){$scope.timeoutId&&clearTimeout($scope.timeoutId)}function calculateTimeUnits(){$scope.seconds=Math.floor($scope.millis/1e3%60),$scope.minutes=Math.floor($scope.millis/6e4%60),$scope.hours=Math.floor($scope.millis/36e5%24),$scope.days=Math.floor($scope.millis/36e5/24)}$scope.autoStart=$attrs.autoStart||$attrs.autostart,0===$element.html().trim().length?$element.append($compile("<span>{{millis}}</span>")($scope)):$element.append($compile($element.contents())($scope)),$scope.startTime=null,$scope.endTime=null,$scope.timeoutId=null,$scope.countdown=$scope.countdownattr&&parseInt($scope.countdownattr,10)>=0?parseInt($scope.countdownattr,10):void 0,$scope.isRunning=!1,$scope.$on("timer-start",function(e,args){var startTime=angular.isNumber(args)?args:void 0;$scope.start(startTime)}),$scope.$on("timer-resume",function(){$scope.resume()}),$scope.$on("timer-stop",function(){$scope.stop()}),$scope.start=$element[0].start=function(startTime){$scope.startTime=$scope.startTimeAttr?new Date($scope.startTimeAttr):new Date,$scope.startTime=startTime?new Date(startTime):$scope.startTime,$scope.endTime=$scope.endTimeAttr?new Date($scope.endTimeAttr):null,$scope.countdown=$scope.countdownattr&&parseInt($scope.countdownattr,10)>0?parseInt($scope.countdownattr,10):void 0,resetTimeout(),tick()},$scope.resume=$element[0].resume=function(){resetTimeout(),$scope.countdownattr&&($scope.countdown+=1),$scope.startTime=new Date-($scope.stoppedTime-$scope.startTime),tick()},$scope.stop=$scope.pause=$element[0].stop=$element[0].pause=function(){$scope.stoppedTime=new Date,resetTimeout(),$scope.$emit("timer-stopped",{millis:$scope.millis,seconds:$scope.seconds,minutes:$scope.minutes,hours:$scope.hours,days:$scope.days}),$scope.timeoutId=null},$element.bind("$destroy",function(){resetTimeout()}),$scope.millis=$scope.countdownattr?1e3*$scope.countdownattr:0,calculateTimeUnits();var tick=function(){$scope.millis=new Date-$scope.startTime;var adjustment=$scope.millis%1e3;if($scope.endTimeAttr&&($scope.millis=$scope.endTime-new Date,adjustment=$scope.interval-$scope.millis%1e3),$scope.countdownattr&&($scope.millis=1e3*$scope.countdown),$scope.millis<0)return $scope.stop(),$scope.millis=0,calculateTimeUnits(),void 0;if(calculateTimeUnits(),$scope.countdown>0)$scope.countdown--;else if($scope.countdown<=0)return $scope.stop(),void 0;$scope.timeoutId=setTimeout(function(){tick(),$scope.$digest()},$scope.interval-adjustment),$scope.$emit("timer-tick",{timeoutId:$scope.timeoutId,millis:$scope.millis})};(void 0===$scope.autoStart||$scope.autoStart===!0)&&$scope.start()}]}}]);
